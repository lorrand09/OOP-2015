<?xml version="1.0" encoding="utf-8"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xml:lang="en" lang="en" xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8" />
    <meta http-equiv="Content-Style-Type" content="text/css" />
    <!-- MOTW-DISABLED saved from url=(0014)about:internet -->
    <title>ModelSim</title>
    <link rel="StyleSheet" href="css/Xilinx_Blockset.css" type="text/css" media="all" />
    <link rel="StyleSheet" href="css/webworks.css" type="text/css" media="all" />
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/context.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/towwhdir.js"></script>
    <script type="text/javascript" language="JavaScript1.2" src="wwhdata/common/wwhpagef.js"></script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        var  WebWorksRootPath = "";
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        // Set reference to top level help frame
        //
        var  WWHFrame = WWHGetWWHFrame("", true);
      // -->
    </script>
    <script type="text/javascript" language="JavaScript1.2" src="scripts/expand.js"></script>
  </head>
  <body onload="WWHUpdate();" onunload="WWHUnload();" onkeydown="WWHHandleKeyDown((document.all||document.getElementById||document.layers)?event:null);" onkeypress="WWHHandleKeyPress((document.all||document.getElementById||document.layers)?event:null);" onkeyup="WWHHandleKeyUp((document.all||document.getElementById||document.layers)?event:null);">
    <table align="left">
      <tr>
        <td class="WebWorks_Company_Logo_Top">
          <img src="logo.gif" />
        </td>
      </tr>
    </table>
    <br clear="all" />
    <br />
    <div class="WebWorks_Breadcrumbs" style="text-align: left;">
      <a class="WebWorks_Breadcrumb_Link" href="Xilinx_Blockset.11.001.html#618404">Xilinx Blockset</a> : ModelSim</div>
    <hr align="left" />
    <blockquote>
      <div class="Heading1"><a name="618404">ModelSim</a></div>
      <div class="Body"><span class="Italic"><a name="615398">This block is listed in the following Xilinx Blockset libraries: Tools and Index.</a></span></div>
      <div class="OneLiner"><a name="410648"><img class="Default" src="images/Xilinx_Blockset.11.067.1.jpg" width="55" height="65" style="display: block; float: none; left: 0.0; top: 0.0" alt="" />The System Generator </a><span class="XBlueLink"><a href="javascript:WWHClickedPopup('sysgen', 'Xilinx_Blockset.11.011.html#327797', '');" title="Black Box">Black Box</a></span> block provides a way to incorporate existing HDL files into a model. When the model is simulated, co-simulation can be used to allow black boxes to participate. The ModelSim HDL co-simulation block configures and controls co-simulation for one or several black boxes. </div>
      <div class="Body"><a name="410652">During a simulation, each ModelSim block spawns one copy of ModelSim, </a>and therefore uses one ModelSim license. If licenses are scarce, several black boxes can share the same block. </div>
      <div class="Body"><a name="410656">In detail, the ModelSim block does the following: </a></div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 18pt; white-space: nowrap;">•      </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="410660">Constructs the additional VHDL and Verilog needed to allow black box HDL to be </a>simulated inside ModelSim. </div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 18pt; white-space: nowrap;">•      </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="410662">Spawns a ModelSim session when a Simulink simulation starts. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 18pt; white-space: nowrap;">•      </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="410664">Mediates the communication between Simulink and ModelSim.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 18pt; white-space: nowrap;">•      </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="410666">Reports if errors are detected when black box HDL is compiled. </a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Bulleted_outer" style="margin-left: 0pt">
        <table border="0" cellspacing="0" cellpadding="0" summary="">
          <tr style="vertical-align: baseline;">
            <td>
              <div class="Bulleted_inner" style="width: 18pt; white-space: nowrap;">•      </div>
            </td>
            <td width="100%">
              <div class="Bulleted_inner"><a name="276461">Terminates ModelSim, if appropriate, when the simulation is complete.</a></div>
            </td>
          </tr>
        </table>
      </div>
      <div class="Note">
        <span class="XNote">Note:&nbsp;</span><a name="1550756">The ModelSim block only supports symbolic radix in the ModelSim tool. In symbolic radix, </a>ModelSim displays the actual values of an enumerated type and also converts an object's value to an appropriate representation for other radix forms. Please refer to the ModelSim documentation for more information on symbolic radix.</div>
      <div class="Heading2"><a name="276462">Block Parameters</a></div>
      <div class="Body"><a name="606565">The block parameters dialog box can be invoked by double-clicking the icon in your </a>Simulink model.</div>
      <div class="Heading3"><a name="606566">Basic tab</a></div>
      <div class="Body"><a name="606567">Parameters specific to the Basic tab are as follows:</a></div>
      <div class="Body"><span class="Bold"><a name="606576">Run co-simulation in directory</a></span>: ModelSim is started in the directory named by this field. The directory is created if necessary. All black box files are copied into this directory, as are the auxiliary files System Generator produces for co-simulation. Existing files are overwritten silently. The directory can be specified as an absolute or relative path. Relative paths are interpreted with respect to the directory in which the Simulink .mdl file resides. </div>
      <div class="Body"><span class="Bold"><a name="606578">Open waveform viewer</a></span>: When this checkbox is selected, the ModelSim waveform window opens automatically, displaying a standard set of signals. The signals include all inputs and outputs of all black boxes and all clock and clock enable signals supplied by System Generator. The signal display can be customized with an auxiliary tcl script. To specify the script, select Add Custom Scripts and enter the script name (e.g., myscript.do) in the Script to Run After vsim field. An example showing a customized waveform viewer is included in <span class="Filename">&lt;ISE_Design_Suite_tree&gt;/sysgen/examples/black_box/example5</span>. This example is in the topic <span class="XBlueLink"><a href="javascript:WWHClickedPopup('sysgen', 'Importing_HDL_Modules.09.6.html#278559', '');" title="Black Box Examples">Advanced Black Box Example Using ModelSim</a></span> . </div>
      <div class="Body"><span class="Bold"><a name="606580">Leave ModelSim open at end of simulation</a></span>: When this checkbox is selected, the ModelSim session is left open after the Simulink simulation has finished. </div>
      <div class="Body"><span class="Bold"><a name="606582">Skip compilation (use previous results)</a></span>: When this checkbox is selected, the ModelSim compilation phase is skipped in its entirety for all black boxes that are using the ModelSim block for HDL co-simulation. To select this option is to assert that: (1) underneath the directory in which ModelSim will run, there exists a ModelSim work directory, and (2) that the work directory contains up-to-date ModelSim compilation results for all black box HDL. Selecting this option can greatly reduce the time required to start-up the simulation, however, if it is selected when inappropriate, the simulation can fail to run or run but produce false results.</div>
      <div class="Heading3"><a name="608300">Advanced tab</a></div>
      <div class="Body"><a name="608301">Parameters specific to the Advanced tab are as follows:</a></div>
      <div class="Body"><span class="Bold"><a name="606584">Include Verilog unisim library</a></span>: Selecting this checkbox ensures that ModelSim includes the Verilog UniSim library during simulation. Note: the Verilog unisim library must be mapped to UNISIMS_VER in ModelSim. In addition, selecting this checkbox ensures the "glbl.v" module is compiled and invoked during simulation. </div>
      <div class="Body"><span class="Bold"><a name="606586">Add custom scripts</a></span>: The term “script” refers to a Tcl macro file (DO file) executed by ModelSim. Selecting this checkbox activates the fields <span class="Bold">Script to Run Before Starting </span><span class="Bold">Compilation</span>, <span class="Bold">Script to Run in Place of "vsim"</span>, and <span class="Bold">Script to Run after "vsim"</span>. The DO file scripts named in these fields are not run unless this checkbox is selected. </div>
      <div class="Body"><span class="Bold"><a name="606588">Script to run before starting compilation</a></span>: Enter the name of a Tcl macro file (DO file) that is to be executed by ModelSim before compiling black box HDL files. </div>
      <div class="Note">
        <span class="XNote">Note:&nbsp;</span><a name="1043936">For information on how to write a ModelSim macro file (DO file) refer to the Chapter in the </a>ModelSim User’s Manual titled <span class="Bold">Tcl and macros (DO files)</span>.</div>
      <div class="Body"><span class="Bold"><a name="606590">Script to run in place of "vsim"</a></span>: ModelSim uses Tcl (tool command language) as the scripting language for controlling and extending the tool. Enter the name of a ModelSim Tcl macro file (DO file) that is to be executed by the ModelSim <span class="Bold">do</span> command at the point when System Generator would ordinarily instruct ModelSim to begin a simulation. To start the simulation after the macro file starts executing, you must place a <span class="Bold">vsim</span> command inside the macro file.</div>
      <div class="Body"><a name="606592">Normally, if this parameter is left blank, or Add custom scripts is not selected, then System </a>Generator instructs ModelSim to execute the default command <span class="Bold">vsim $toplevel -title </span><span class="Bold">{System Generator Co-Simulation (from block $blockname}</span> Here <span class="Bold">$toplevel</span> is the name of the top level entity for simulation (e.g., work.my_model_mti_block) and <span class="Bold">$blockname</span> is the name of the ModelSim block in the Simulink model associated with the current co-simulation. To avoid problems, certain characters in the block name (e.g., newlines) are sanitized. </div>
      <div class="Body"><a name="606594">If this parameter is not blank and </a><span class="Bold">Add custom scripts</span> is selected, then System Generator instead instructs ModelSim to execute <span class="Bold">do $* $toplevel $blockname</span>. Here <span class="Bold">$toplevel</span> and <span class="Bold">$blockname</span> are as above and <span class="Bold">$*</span> represents the literal text entered in the field. If, for example the literal text is '<span class="Bold">foo.do</span>', then ModelSim executes <span class="Bold">foo.do</span>. This macro file can then reference <span class="Bold">$toplevel</span> and <span class="Bold">$blockname</span> as $1 and $2, respectively. Thus, the command <span class="Bold">vsim </span><span class="Bold">$1</span> inside of the macro file <span class="Bold">foo.do</span> runs vsim on topLevel. </div>
      <div class="Body"><span class="Bold"><a name="606596">Script to run after "vsim"</a></span>: Enter the name of a Tcl macro file (DO file) that is to be executed by ModelSim after all the HDL for black boxes has been successfully compiled, and after the ModelSim simulation has completed successfully. If the <span class="Bold">Open Waveform Viewer</span> checkbox has been selected, System Generator issues all commands it ordinarily uses to open and customize the waveform viewer before running this script. This allows you to customize the waveform viewer as desired (either by adding signals to the default viewer or by creating a fully custom viewer). The black box tutorial includes an example that customizes the waveform viewer. </div>
      <div class="Body"><a name="276463">It is often convenient to use relative paths in a custom script. Relative paths are interpreted </a>with respect to the directory that contains the model's MDL file. A relative path in the Run co-simulation in directory field is also interpreted with respect to the directory that contains the model's MDL file. Thus, for example, if Run co-Simulation in directory specifies ./modelsim as the directory in which ModelSim should run, the relative path ../foo.do in a script definition field refers to a file named foo.do in the directory that contains the .mdl.</div>
      <div class="Heading2"><a name="608354">Fine Points</a></div>
      <div class="Body"><a name="608357">The time scale in ModelSim matches that in Simulink, i.e., one second of Simulink </a>simulation time corresponds to one second of ModelSim simulation time. This makes it easy to compare times at which events occur in the two settings. The typically large Simulink time scale is also useful because it allows System Generator to schedule events without running into problems related to the timing characteristics of the HDL model. Users needn't worry too much about the details System Generator event scheduling in co-simulation models. The following example is offered to illustrate the broader points. </div>
      <div class="Body"><a name="608351">This example model shown here can be found in the System Generator directory </a><span class="Filename">&lt;ISE_Design_Suite_tree&gt;/sysgen/example/black_box/example4</span>. The example is also discussed in the topic <span class="XBlueLink"><a href="javascript:WWHClickedPopup('sysgen', 'Importing_HDL_Modules.09.6.html#282949', '');" title="Black Box Examples">Importing a Verilog Module</a></span> . </div>
      <table class="FigureNoTitle" style="text-align: left; width: 396pt" cellspacing="0" summary="">
        <caption></caption>
        <tr>
          <td style="padding-bottom: 0pt; padding-left: 0pt; padding-right: 0pt; padding-top: 0pt; vertical-align: top; width: 396.0pt">
            <div class="Anchor"><a name="608709"><img class="Default" src="images/Xilinx_Blockset.11.067.2.jpg" width="395" height="188" style="display: block; float: none; left: 0.0; top: 0.0" alt="" /></a></div>
          </td>
        </tr>
      </table>
      <div class="Body"><a name="608713">When the above model is run, the following waveforms are displayed by ModelSim: </a></div>
      <table class="FigureNoTitle" style="text-align: left; width: 396pt" cellspacing="0" summary="">
        <caption></caption>
        <tr>
          <td style="padding-bottom: 0pt; padding-left: 0pt; padding-right: 0pt; padding-top: 0pt; vertical-align: top; width: 396.0pt">
            <div class="Anchor"><a name="608723"><img class="Default" src="images/Xilinx_Blockset.11.067.3.jpg" width="317" height="247" style="display: block; float: none; left: 0.0; top: 0.0" alt="" /></a></div>
          </td>
        </tr>
      </table>
      <div class="Body"><a name="608727">At the time scale presented here (the above shows a time interval of six seconds), the rising </a>clock edge at three seconds and the corresponding transmission of data through each of the two black boxes appear simultaneous, much as they do in the Simulink simulation. Looking at the model, however, it is clear that the output of the first black box feeds the second black box. Both of the black boxes in this model have combinational feed-throughs, i.e., changes on inputs translate into immediate changes on outputs. Zooming in toward the three second event reveals how System Generator has resolved the dependencies. Note the displayed time interval has shrunk to ~20 ms.</div>
      <table class="FigureNoTitle" style="text-align: left; width: 396pt" cellspacing="0" summary="">
        <caption></caption>
        <tr>
          <td style="padding-bottom: 0pt; padding-left: 0pt; padding-right: 0pt; padding-top: 0pt; vertical-align: top; width: 396.0pt">
            <div class="Anchor"><a name="608737"><img class="Default" src="images/Xilinx_Blockset.11.067.4.jpg" width="319" height="247" style="display: block; float: none; left: 0.0; top: 0.0" alt="" /></a></div>
          </td>
        </tr>
      </table>
      <div class="Body"><a name="609037">The above figure reveals that System Generator has shifted the rising clock edge so it </a>occurs before the input value is collected from Simulink and presented to the first of the black boxes. It then allows the value to propagate through the first black box and presents the result to the second at a slightly later time. Zooming in still further shows that the HDL model for the first black box includes a propagation delay which System Generator has effectively abstracted away through the use of large time scales. The actual delay through the first black box (exactly1 ns) can be seen in the figure below.</div>
      <table class="FigureNoTitle" style="text-align: left; width: 396pt" cellspacing="0" summary="">
        <caption></caption>
        <tr>
          <td style="padding-bottom: 0pt; padding-left: 0pt; padding-right: 0pt; padding-top: 0pt; vertical-align: top; width: 396.0pt">
            <div class="Anchor"><a name="609047"><img class="Default" src="images/Xilinx_Blockset.11.067.5.jpg" width="320" height="247" style="display: block; float: none; left: 0.0; top: 0.0" alt="" /></a></div>
          </td>
        </tr>
      </table>
      <div class="Body"><a name="609051">In propagating data through black box components, System Generator allocates 1/ 1000 of </a>the system clock period down to 1us, then shrinks the allocation to 1/100 of the system clock period down to 5ns, and below that threshold resorts to delta-delay stepping, i.e. issuing "run 0 ns" commands to ModelSim. If the HDL includes timing information (e.g,. transport delays) and the Simulink System Period is set too low, then the simulation results will be incorrect. The above model begins to fail when the Simulink system period setting is reduced below 5e-7, which is the point at which System Generator resorts to delta-delay stepping of the black boxes for data propagation.</div>
      <script type="text/javascript" language="JavaScript1.2">
        <!--
          // Clear related topics
          //
          WWHClearRelatedTopics();

          document.writeln(WWHRelatedTopicsInlineHTML());
        // -->
      </script>
    </blockquote>
    <script type="text/javascript" language="JavaScript1.2">
      <!--
        document.write(WWHRelatedTopicsDivTag() + WWHPopupDivTag() + WWHALinksDivTag());
      // -->
    </script>
  </body>
</html>